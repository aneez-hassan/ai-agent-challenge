# ai-agent-challenge

**Structure:**
ai-agent-challenge/
│
├─ agent.py                 # Main CLI agent file
├─ custom_parsers/
│   └─ icici_parser.py      # Generated by agent.py
├─ data/
│   └─ icici/
│       ├─ icic_sample.pdf
│       └─ icic_sample.csv
├─ tests/
│   └─ test_icici_parser.py
├─ README.md
└─ requirements.txt

**agent.py Skeleton**
import os
import sys
import pandas as pd
from pathlib import Path

# Optional: LangGraph or LLM imports
# from langgraph import Agent, Tool

TARGET = sys.argv[1] if len(sys.argv) > 1 else "icici"

PDF_PATH = f"data/{TARGET}/{TARGET}_sample.pdf"
CSV_PATH = f"data/{TARGET}/{TARGET}_sample.csv"
OUTPUT_PARSER = f"custom_parsers/{TARGET}_parser.py"


def generate_parser(target: str, output_path: str):
    """
    Writes a Python parser template for the given bank target.
    """
    os.makedirs(os.path.dirname(output_path), exist_ok=True)

    parser_code = f'''
import pandas as pd

def parse(pdf_path: str) -> pd.DataFrame:
    """
    Parse {target.upper()} bank statement PDF and return DataFrame.
    """
    # TODO: Implement PDF parsing logic
    # Example: Use PyPDF2, pdfplumber, or pytesseract for OCR
    return pd.DataFrame()  # placeholder
'''

    with open(output_path, "w") as f:
        f.write(parser_code)
    print(f"Parser for {target} written to {output_path}")


def main():
    generate_parser(TARGET, OUTPUT_PARSER)
    # Optional: run test
    if os.path.exists(CSV_PATH):
        df_expected = pd.read_csv(CSV_PATH)
        from importlib import import_module
        parser_module = import_module(f"custom_parsers.{TARGET}_parser".replace("/", "."))
        df_parsed = parser_module.parse(PDF_PATH)
        if df_parsed.equals(df_expected):
            print("✅ Parser matches CSV")
        else:
            print("❌ Parser output does not match CSV")


if __name__ == "__main__":
    main()
    
**Test Example**
# tests/test_icici_parser.py
import pandas as pd
from custom_parsers.icici_parser import parse

def test_icici_parser():
    pdf_path = "data/icici/icic_sample.pdf"
    csv_path = "data/icici/icic_sample.csv"
    df_expected = pd.read_csv(csv_path)
    df_parsed = parse(pdf_path)
    assert df_parsed.equals(df_expected)

**How Agent Works**
Loop (plan → generate → test → refine)
The agent.py reads the bank target (--target icici)
Writes a parser template in custom_parsers/
Imports parser, runs on PDF, compares with expected CSV
Can retry/update parser ≤ 3 attempts (self-debug loop)

**CLI Usage**
# Install dependencies
pip install pandas PyPDF2 reportlab pdfplumber pytesseract
# Run agent for ICICI
python agent.py icici

**Expected output:**
Parser for icici written to custom_parsers/icici_parser.py
❌ Parser output does not match CSV   # until parse() is implemented

**Optional: Future Improvements**
Add LangGraph or LLM loop to automatically refine parser on test failures
Add support for other banks like SBI, HDFC
Use OCR for scanned PDFs (pytesseract)
Generate parser diagrams in README (graph showing agent plan → code → test → fix)

